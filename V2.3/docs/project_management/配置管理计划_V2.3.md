# 配置管理计划（SCMP）— 星河超脑 V2.3

版本：V2.3 初版  | 所属阶段：概念设计/开发准备  | 适用范围：全项目

## 1. 目的与范围
- 目的：对项目的配置项进行识别、控制、状态记录与审计，
  保证产物可追溯、可回滚、可复现。
- 范围：源代码、文档、构建脚本、配置、测试数据、
  发布制品与部署镜像等。

## 2. 配置项识别（CI）
- 源代码与测试：src/、tests/、tools/、core/ 等。
- 文档：V2.3/docs/、docs/、mkdocs.yml。
- 配置与脚本：config/*.yml、scripts/、Dockerfile、.env.*。
- 数据与迁移：db/migrations/、data/。
- 构建与报告：reports/、archives/、site/（静态站点）。

## 3. 仓库与分支策略
- main：稳定可发布分支；release：发布准备；
  develop：日常集成；feature/*：特性；hotfix/*：紧急修复。
- PR 门槛：通过 CI 门禁、至少 2 人 Review（含 1 名 Owner）。
- 命名规范：feature/<模块>-<简述>、hotfix/<问题号>-<简述>。

## 4. 版本与标记
- 采用语义化版本：v2.3.x（核心变更升次版本号）。
- 预发布标记：-alpha/-beta/-rc（如 v2.3.0-rc1）。
- 变更日志：遵循 Keep a Changelog；重要变更需“迁移指南”。

## 5. 变更控制
- 变更申请（CR）→ 影响分析 → 评审与批准 → 实施与验证 → 归档。
- 破坏性接口需附带契约变更说明与兼容策略（Deprecation 周期）。

## 6. 基线管理
- 冻结点：概念设计方案、软件开发计划书、SQAP、SCMP、
  API 契约、错误码字典。
- 每个冻结点打 Tag 并归档快照（源代码 + 文档 + 报表）。

## 7. 构建与发布
- 构建产物：
  - 源代码包（zip/tar.gz）、镜像（Dockerfile）与静态站点（mkdocs）。
  - 测试与质量报告（coverage、lint、安全扫描、契约测试）。
- 标准化目录：archives/releases/v2.3/<版本>/<时间戳>/。
- 镜像命名：starriver:<version>（如 starriver:2.3.0-rc1）。

## 8. 制品仓库与签名
- 产物清单（manifest）：文件名、大小、SHA256、生成时间、来源 Tag。
- 签名与校验：提供 SHA256 校验文件，发布前后双向校验。
- SBOM（如具备工具）：生成并归档，供安全审计与依赖追溯。

## 9. 状态记录与审计
- 记录项：变更编号、提交范围、审查结论、构建号、Tag、
  质量门禁结果、制品路径与校验值。
- 审计周期：里程碑前与发布后进行合规性抽查。

## 10. 环境配置管理
- 环境分层：dev/test/staging/prod；配置与密钥分离管理。
- 模板：.env.template，实际敏感信息不入库，按环境注入。
- 回滚：保留最近 3 个可用版本与 DB 迁移回滚脚本（如适用）。

## 11. 发布与回滚流程（摘要）
1) 创建 release/* 分支并提升版本号
2) CI 全量门禁通过，生成制品与清单
3) 创建 Tag，归档到 archives/releases
4) 部署到 test/staging，执行验收与影子流量回放
5) 生产放量发布，实时监控并准备一键回滚脚本

## 12. KPI 与改进
- 追溯性：CR→提交→构建→制品→部署 一致性 ≥ 99%。
- 回滚成功率：100%；平均回滚时间 ≤ 5 分钟（脚本化）。
- 制品可复现实验：每迭代至少一次全链路复现演练。

## 13. 附录：模板（节选）
- 变更申请（CR）模板
- 版本与发布记录模板
- 制品清单（manifest）与校验记录模板

## 14. 文档与资料归档策略（更新：改为每日归档）

- 归档频率：每日 10:00 固定快照 + 里程碑/关键合并（Tag/Release）即时快照。
- 归档范围：V2.3/docs 下 requirements、design、testing、market_research、summary、tools 的全部 Markdown（.md）文档；assets 仅归档 SVG（源文件另行保存）。
- 存放路径：V2.3/archives/docs/YYYY-MM-DD/{类别}/，文件命名为“原文件名_快照.md”。
- 自动化脚本：scripts/archive_docs.ps1；建议由计划任务（Windows 任务计划程序）每日执行一次。失败自动重试 3 次，必要时切换手动归档并记录至《AI 工具链降级日志》；恢复后回写《AI 工具链执行日志》。
- 审计与追溯：每周抽检归档完整性与一致性；归档目录与发布 Tag 的一致性≥99%。

修订记录：2025-08-20 将“每周归档”调整为“每日归档”，新增自动化脚本与审计要求（负责人：星河）。

[更新公告｜V2.3 CE/EMO 扩展｜2025-08-21]
本计划在V2.3版本中扩展纳入云端持续进化（CE：Cloud Evolution）与叙事记忆册（EMO：Narrative Memory Book）的配置管理范围，并启用 v2.3-preview 阶段控制。关键变更如下：
- 配置项与特性开关：cloud_evolution_enabled=true，narrative_book_enabled=true（均支持随时回滚）；api_version_prefix=/api/v2.3-preview。
- 接口与路由：新增占位 /cloud/consent、/cloud/status、/memory/sync、/memory/export；CE/EMO 命名空间统一纳入配置清单管理。
- 合规与审计：新增 Consent Policy、Data Residency、Audit/TraceID 配置对象；强制最小化采集、双重确认、撤销与擦除权流程配置。
- 基线与变更控制：配置基线版本升级（包含 consents、cloud_sync_jobs、narrative_entries、memory_links、audit_logs 等DB迁移脚本与回滚脚本）；变更评审增加隐私合规与影子回放差异阈值门禁（默认5%）。
- 分支与发布：新增 ce/*、emo/* 分支策略与 v2.3-preview 标签；发布包中纳入合规模型、策略与迁移校验；一键回退预案与影子回放机制纳入发布清单。
- 凭据与密钥：禁止明文入库与入仓，统一KMS管控，最小权限访问；密钥轮转SOP与审计追踪入库。