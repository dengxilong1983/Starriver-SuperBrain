# 可追溯性矩阵_V2.3

> 更新公告（2025-01-21）
> - 新增 REQ-AGT-*（多智能体系统）需求族映射，包含7个核心接口与对应用例、测试用例ID映射；
> - 补齐 REQ-CE-*、REQ-EMO-*、REQ-CON-*、REQ-OBS-* 需求族映射，形成完整的V2.3需求追溯体系。

> v0.2 补充（2025-08-21）
> - 补全 REQ ↔ UC ↔ API ↔ NFR ↔ TC 多向映射，标注优先级与状态，提供空缺项提示。

- 版本：V2.3
- 文档状态：v0.3（多智能体更新）
- 作者：星河
- 审批：熙龙（待审批）
- 最近修订：2025-01-21

## 1. 矩阵视图（文字版）

### 1.1 多智能体系统（AGT）需求族
- REQ-AGT-001 多智能体任务调度
  - UC: UC-MA-001（多智能体研究报告自动化）
  - API: POST /api/v2.3-preview/agents/run
  - NFR: 响应时间 P95≤2s，P99≤5s；可用性≥99.5%；并发≥50任务
  - TC: TC-INT-AGT-001, TC-E2E-MA-001, TC-PERF-AGT-001
  - 状态：设计完成，待实现

- REQ-AGT-002 任务状态查询与监控
  - UC: UC-MA-001（状态追踪子场景）
  - API: GET /api/v2.3-preview/agents/tasks/{task_id}
  - NFR: 查询响应≤300ms；状态同步延迟≤10s
  - TC: TC-INT-AGT-002, TC-E2E-AGT-002
  - 状态：设计完成，待实现

- REQ-AGT-003 任务结果获取与追溯
  - UC: UC-MA-001（结果获取子场景）
  - API: GET /api/v2.3-preview/agents/tasks/{task_id}/result
  - NFR: 结果完整性≥99.5%；引用准确率≥96%；质量评分覆盖率100%
  - TC: TC-INT-AGT-003, TC-QUAL-AGT-003, TC-E2E-AGT-003
  - 状态：设计完成，待实现

- REQ-AGT-004 Agent状态监控与健康检查
  - UC: UC-AGT-004（系统监控）
  - API: GET /api/v2.3-preview/agents/status
  - NFR: 监控数据刷新≤30s；系统负载指标准确率≥98%
  - TC: TC-SYS-AGT-004, TC-MON-AGT-004
  - 状态：设计完成，待实现

- REQ-AGT-005 任务取消与资源释放
  - UC: UC-AGT-005（任务管理）
  - API: DELETE /api/v2.3-preview/agents/tasks/{task_id}
  - NFR: 取消响应≤3s；资源释放率≥95%；预算退款准确率100%
  - TC: TC-INT-AGT-005, TC-E2E-AGT-005
  - 状态：设计完成，待实现

- REQ-AGT-006 Agent配置管理与动态调整
  - UC: UC-AGT-006（配置管理）
  - API: PUT /api/v2.3-preview/agents/config
  - NFR: 配置更新≤10s生效；配置验证准确率100%
  - TC: TC-INT-AGT-006, TC-CONFIG-AGT-006
  - 状态：设计完成，待实现

- REQ-AGT-007 执行轨迹详情与调试
  - UC: UC-AGT-007（执行追踪）
  - API: GET /api/v2.3-preview/agents/tasks/{task_id}/trace
  - NFR: 轨迹完整性≥99%；轨迹查询≤1s；调试信息覆盖率≥90%
  - TC: TC-INT-AGT-007, TC-DEBUG-AGT-007
  - 状态：设计完成，待实现

### 1.2 原有需求族（已对齐）
- REQ-CE-001 云端授权创建
  - UC: CE-UC-001
  - API: POST /cloud/consent
  - NFR: 安全-鉴权、审计；可用性 99.9%
  - TC: TC-INT-CE-001, TC-E2E-CE-001, TC-SEC-CE-001
  - 状态：设计已完成（SRS v0.2），测试待补充

- REQ-CE-002 云端授权撤销与回滚
  - UC: CE-UC-002
  - API: DELETE /cloud/consent
  - NFR: 可回滚 ≤ 10 分钟；审计完整
  - TC: TC-INT-CE-002, TC-E2E-CE-002, TC-SEC-CE-002
  - 状态：设计已完成（SRS v0.2），测试待补充

- REQ-CE-003 增量同步（幂等+冲突）
  - UC: CE-UC-003
  - API: POST /memory/sync
  - NFR: P95 ≤ 300ms；错误率 ≤ 0.1%
  - TC: TC-INT-CE-003, TC-PERF-CE-003, TC-REL-CE-003
  - 状态：进行中

- REQ-CE-004 导出（脱敏+审计）
  - UC: CE-UC-004
  - API: GET /memory/export
  - NFR: 10MB ≤ 5s；DLP 通过
  - TC: TC-INT-CE-004, TC-SEC-CE-004, TC-E2E-CE-004
  - 状态：进行中

- REQ-EMO-001 叙事条目 CRUD（软删除）
  - UC: EMO-UC-001
  - API: 内部接口（模块边界）
  - NFR: 恢复 ≤ 10 分钟；审计保留 30 天
  - TC: TC-UNIT-EMO-001, TC-INT-EMO-001
  - 状态：设计完成

- REQ-EMO-002 情感标签与引用链
  - UC: EMO-UC-002
  - API: 内部接口 + 查询
  - NFR: 查询 P95 ≤ 200ms；权重一致性
  - TC: TC-UNIT-EMO-002, TC-INT-EMO-002
  - 状态：进行中

- REQ-CON-001 意识状态机与目标管理
  - UC: UC-CON-001（状态切换）
  - API: GET/POST /consciousness/state
  - NFR: 状态切换 P95 ≤ 50ms、P99 ≤ 80ms；转换日志完备
  - TC: TC-UNIT-CON-001, TC-INT-CON-001, TC-E2E-CON-001
  - 状态：设计完成，待实现

- REQ-CON-002 注意力路由与记忆门控
  - UC: UC-CON-002（注意力分配）
  - API: 内部策略（与 reasoning/memory/execution 交互）；对外 POST /consciousness/state 控制开关
  - NFR: 推荐路径准确率 ≥ 80%；门控策略可回放
  - TC: TC-UNIT-CON-002, TC-INT-CON-002
  - 状态：设计完成，待实现

- REQ-CON-003 推理链与解释性
  - UC: UC-CON-003（解释生成）
  - API: POST /reasoning/plan（explain 可选）
  - NFR: 至少 3 个关键决策点；引用可追溯
  - TC: TC-INT-CON-003, TC-E2E-CON-003
  - 状态：进行中（与推理模块联动）

- REQ-OBS-001 结构化日志与埋点
  - UC: UC-OBS-001（日志采集）
  - API: 跨端点埋点 /reasoning/plan, /execution/act, /consciousness/state, /memory/sync
  - NFR: 覆盖率 ≥ 95%；单条日志 ≤ 4KB；敏感字段脱敏
  - TC: TC-INT-OBS-001, TC-SEC-OBS-001
  - 状态：设计完成，待实现

- REQ-OBS-002 实时指标收集
  - UC: UC-OBS-002（指标采集）
  - API: GET /observability/metrics（Prom 文本或本地聚合）
  - NFR: 指标刷新 ≤ 10s；导出接口可用；断点恢复
  - TC: TC-PERF-OBS-002, TC-INT-OBS-002
  - 状态：预研完成，待实现

- REQ-OBS-003 可视化仪表板（预览期简化）
  - UC: UC-OBS-003（监控展示）
  - API: 预览期为 CLI/离线 HTML 报表；后续绑定 /observability/metrics
  - NFR: 至少 6 项核心指标；报表导出 ≤ 1s
  - TC: TC-SYS-OBS-003
  - 状态：待实现

## 2. 缺口与后续计划
- 为每条 AGT-REQ 生成对应测试用例列表与示例数据集；在 testing 目录建立自动化计划。
- 生成 OpenAPI 契约并绑定到接口测试，特别是多智能体 `/agents/run` 接口族。
- 将多智能体评测指标与告警策略挂载到 NFR 行，确保上线门禁可执行。
- 完善跨需求族的依赖关系映射（如AGT依赖CON的状态管理、OBS的监控体系）。

## 3. 变更记录
- 2025-08-20：新增映射占位（星河）
- 2025-08-21：v0.2 补全主要映射（星河）
- 2025-01-21：v0.3 新增多智能体系统（AGT）需求族完整映射（星河）

## 配套资产与执行说明（v2.3-preview）
- 契约文件：docs/requirements/api/openapi_v2.3-preview.yaml
- Postman 集合：docs/requirements/api/postman/openapi_v2.3-preview.postman_collection.json
- Postman 环境：docs/requirements/api/postman/env_v2.3-preview.postman_environment.json
- Mock 启动指南：见《接口需求清单_V2.3.md》"本地契约 Mock 启动指南（可选）"。
- 契约测试入口：见《接口需求清单_V2.3.md》"契约测试指南（快速）"。

执行建议：
- 先用 Prism Mock 验证基本契约一致性，再切换真实后端跑 Schemathesis 属性测试。
- 多智能体接口需重点关注并发、超时、错误恢复等异常场景测试。
- 测试报告与日志请归档至 docs/requirements/api/reports/（自建目录）。